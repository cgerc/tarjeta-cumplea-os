<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invitaci√≥n Cumplea√±os Sonic</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- SheetJS para Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* TU CSS ORIGINAL COMPLETO (lo mantengo igual) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial Black', sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%); min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; overflow-x: hidden; overflow-y: auto; position: relative; padding: 20px 0; }
        .stars { position: absolute; width: 100%; height: 100%; overflow: hidden; }
        .star { position: absolute; width: 3px; height: 3px; background: white; border-radius: 50%; animation: twinkle 2s infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .container { background: linear-gradient(145deg, #0066ff, #0052cc); border-radius: 30px; padding: 40px; max-width: 600px; width: 90%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), inset 0 -5px 20px rgba(255, 255, 255, 0.2); position: relative; z-index: 10; border: 5px solid #ffd700; margin: 20px auto; }
        img { max-width: 100%; height: auto; display: block; margin: 0 auto; border-radius: 3%; border: 5px solid #ffd700; box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        .title { color: white; font-size: 32px; text-shadow: 3px 3px 0 #ff0000; margin: 15px 0; animation: flash 1.5s ease-in-out infinite; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        .invite-content { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; margin: 20px 0; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .info-item { margin: 15px 0; font-size: 18px; color: #0052cc; display: flex; align-items: center; gap: 10px; }
        .age-badge { display: inline-block; background: linear-gradient(135deg, #ff0000, #ff6b00); color: white; padding: 10px 25px; border-radius: 50px; font-size: 28px; font-weight: bold; margin: 15px 0; box-shadow: 0 5px 15px rgba(255, 0, 0, 0.4); animation: rotate-badge 2s ease-in-out infinite; }
        @keyframes rotate-badge { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }
        .button { background: linear-gradient(135deg, #ff0000, #ff6b00); color: white; border: none; padding: 15px 40px; font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer; margin: 20px 5px; box-shadow: 0 8px 20px rgba(255, 0, 0, 0.4); transition: all 0.3s ease; text-transform: uppercase; }
        .button:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 12px 30px rgba(255, 0, 0, 0.6); }
        .confetti { position: fixed; width: 10px; height: 10px; opacity: 0; pointer-events: none; }
        @keyframes confetti-fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
        .hidden { display: none; }
        .form-container { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; margin: 20px 0; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .form-group { margin: 20px 0; }
        .form-group label { display: block; color: #0052cc; font-size: 16px; font-weight: bold; margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 3px solid #0066ff; border-radius: 10px; font-size: 16px; font-family: Arial, sans-serif; transition: all 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #ff0000; box-shadow: 0 0 15px rgba(255, 0, 0, 0.3); }
        .checkbox-group { display: flex; align-items: center; gap: 10px; }
        .checkbox-group input[type="checkbox"] { width: 25px; height: 25px; cursor: pointer; }
        .guest-list { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; margin: 20px 0; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); max-height: 300px; overflow-y: auto; }
        .guest-list h3 { color: #0052cc; margin-bottom: 15px; text-align: center; }
        .guest-item { background: linear-gradient(135deg, #e3f2fd, #bbdefb); padding: 15px; border-radius: 10px; margin: 10px 0; border-left: 5px solid #0066ff; }
        .guest-item p { margin: 5px 0; color: #0052cc; font-size: 14px; }
        .guest-item strong { color: #ff0000; }
        .message { background: linear-gradient(135deg, #ffd700, #ffed4e); padding: 20px; border-radius: 15px; margin: 20px 0; font-size: 18px; color: #0052cc; font-weight: bold; text-align: center; animation: appear 0.5s ease-out; }
        @keyframes appear { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .music-control { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #ff0000, #ff6b00); border: 3px solid #ffd700; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 5px 20px rgba(255, 0, 0, 0.6); z-index: 1000; transition: all 0.3s ease; }
        .music-icon { font-size: 28px; color: white; }
        .music-control.playing { animation: pulse 1s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        /* Responsive (mant√©n tu responsive original) */
        @media (max-width: 480px) { /* ... tu media queries ... */ }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>

    <div class="container">
        <div class="speed-lines" style="top: 20%;"></div>
        <div class="speed-lines" style="top: 50%; animation-delay: 0.5s;"></div>
        <div class="speed-lines" style="top: 80%; animation-delay: 1s;"></div>
        
        <div class="sonic-header">
           <img src="sonicbaile.gif" alt="Sonic bailando">
            <h1 class="title" style="text-align:center">¬°Acomp√°√±anos a celebrar!</h1>
        </div>

        <div class="invite-content">   
            <div style="text-align: center;">
                <div class="age-badge">
                    <span id="age">Santino 5</span> a√±os
                </div>
            </div>

            <div class="info-item">
                <span class="icon">üìÖ</span>
                <strong>Fecha:</strong> <span id="date">S√°bado 17 de Enero</span>
            </div>

            <div class="info-item">
                <span class="icon">‚è∞</span>
                <strong>Hora:</strong> <span id="time">16:00 a 19:00hrs</span>
            </div>

           <div class="info-item">
                <span class="icon">üìç</span>
                <strong>Lugar:</strong> <a href="https://maps.app.goo.gl/6dsKesWeEKrHufhz9" target="_blank" style="color: #ff0000; text-decoration: none; font-weight: bold;">Ver ubicaci√≥n en Google Maps üó∫Ô∏è</a>
            </div>
        </div>

        <div class="form-container">
            <h3 style="color: #0052cc; text-align: center; margin-bottom: 20px;">üìù Confirmaci√≥n de Asistencia</h3>
            
            <div class="form-group">
                <label for="guestName">Nombre del/la invitad@ *</label>
                <input type="text" id="guestName" placeholder="Nombre y apellido" required>
            </div>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="hasCar">
                    <label for="hasCar">üöó ¬øVendr√°s en auto?</label>
                </div>
            </div>

            <div class="form-group">
                <label for="dietary">Restricciones alimentarias (opcional)</label>
                <textarea id="dietary" placeholder="Ej: Vegetariano, al√©rgico a nueces, cel√≠aco, etc."></textarea>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="button" onclick="confirmarAsistencia()">‚úì CONFIRMAR ASISTENCIA</button>
            </div>

            <div id="confirmMessage" class="message hidden">
                ¬°Nos vemos en la fiesta! üéâ
            </div>
        </div>

        <div class="guest-list hidden" id="guestList">
            <h3>üéä Lista de Invitados Confirmados</h3>
            <div id="guestItems"></div>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <button class="button" onclick="verInvitados()">üë• VER INVITADOS</button>
            <button class="button" onclick="descargarExcel()" style="background: linear-gradient(135deg, #00cc00, #00aa00);">üì• DESCARGAR EXCEL</button>
        </div>
    </div>

    <div class="music-control" id="musicControl" onclick="toggleMusic()">
        <span class="music-icon" id="musicIcon">üéµ</span>
    </div>

    <audio id="backgroundMusic" loop>
        <source src="https://cdn.freesound.org/previews/442/442127_5121236-lq.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ====== FIREBASE ======
        const firebaseConfig = {
          apiKey: "AIzaSyD5goNmwrAVseZlhBNLaCU7qfKZCs5sThY",
          authDomain: "tarjeta-cumple-c774c.firebaseapp.com",
          projectId: "tarjeta-cumple-c774c",
          storageBucket: "tarjeta-cumple-c774c.firebaseapp.com",
          messagingSenderId: "272528438834",
          appId: "1:272528438834:web:5b3c7cde927b14f4a6ee2b",
          measurementId: "G-F7T3LM57WB"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const invitadosRef = db.collection('invitados');

        let guests = [];

        // M√∫sica
        const music = document.getElementById('backgroundMusic');
        const musicControl = document.getElementById('musicControl');
        const musicIcon = document.getElementById('musicIcon');
        let musicPlaying = false;

        function toggleMusic() {
            if (musicPlaying) {
                music.pause();
                musicIcon.textContent = 'üéµ';
                musicControl.classList.remove('playing');
            } else {
                music.play().catch(() => {});
                musicIcon.textContent = 'üîä';
                musicControl.classList.add('playing');
            }
            musicPlaying = !musicPlaying;
        }

        // Estrellas
        function crearEstrellas() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Confetti
        function createConfetti() {
            const colors = ['#ff0000', '#ffd700', '#0066ff', '#00ff00', '#ff00ff'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.opacity = '1';
                    confetti.style.animation = `confetti-fall ${2 + Math.random() * 2}s linear forwards`;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }

        // Confirmar asistencia
        async function confirmarAsistencia() {
            const name = document.getElementById('guestName').value.trim();
            const hasCar = document.getElementById('hasCar').checked;
            const dietary = document.getElementById('dietary').value.trim();

            if (!name) {
                alert('Por favor ingresa tu nombre');
                return;
            }

            try {
                await invitadosRef.add({
                    name,
                    hasCar,
                    dietary: dietary || 'Ninguna',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                const message = document.getElementById('confirmMessage');
                message.classList.remove('hidden');
                createConfetti();

                document.getElementById('guestName').value = '';
                document.getElementById('hasCar').checked = false;
                document.getElementById('dietary').value = '';

                setTimeout(() => message.classList.add('hidden'), 3000);
            } catch (error) {
                alert('Error al guardar. Abre la consola (F12) para ver el error.');
                console.error(error);
            }
        }

        // Cargar lista en tiempo real
        function cargarInvitadosDesdeFirebase() {
            invitadosRef.orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                guests = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    guests.push({
                        name: data.name,
                        hasCar: data.hasCar,
                        dietary: data.dietary
                    });
                });
                actualizarListaInvitados();
            }, error => {
                console.error('Error cargando lista:', error);
            });
        }

        function actualizarListaInvitados() {
            const guestItems = document.getElementById('guestItems');
            guestItems.innerHTML = '';

            if (guests.length === 0) {
                guestItems.innerHTML = '<p style="text-align:center; color:#0052cc;">A√∫n no hay invitados confirmados</p>';
                return;
            }

            guests.forEach(guest => {
                const item = document.createElement('div');
                item.className = 'guest-item';
                item.innerHTML = `
                    <p><strong>${guest.name}</strong></p>
                    <p>üöó Viene en auto: ${guest.hasCar ? 'S√≠' : 'No'}</p>
                    <p>üçΩÔ∏è Restricciones: ${guest.dietary}</p>
                `;
                guestItems.appendChild(item);
            });
        }

        function verInvitados() {
            const guestList = document.getElementById('guestList');
            guestList.classList.toggle('hidden');
        }

        function descargarExcel() {
            if (guests.length === 0) {
                alert('No hay invitados para descargar');
                return;
            }

            const datosExcel = guests.map((guest, index) => ({
                'N¬∞': index + 1,
                'Nombre': guest.name,
                'Viene en Auto': guest.hasCar ? 'S√≠' : 'No',
                'Restricciones Alimentarias': guest.dietary
            }));

            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(datosExcel);
            ws['!cols'] = [{ wch: 5 }, { wch: 30 }, { wch: 15 }, { wch: 40 }];
            XLSX.utils.book_append_sheet(wb, ws, 'Invitados');

            const fecha = new Date().toLocaleDateString('es-CL').replace(/\//g, '-');
            XLSX.writeFile(wb, `Invitados_Cumplea√±os_Santino_${fecha}.xlsx`);
        }

        // Inicializar todo
        window.addEventListener('load', () => {
            crearEstrellas();
            toggleMusic(); // Para intentar autoplay
            cargarInvitadosDesdeFirebase();
        });
    </script>
</body>
</html>